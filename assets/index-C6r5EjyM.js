import{d as w,$ as v,f as C,D as S,W as _,a5 as D,k as n,Y as u,G as P,u as c,ac as V}from"./vue-nPfkdNmw.js";import{s as k,b as x}from"./columns-DNWCDx8h.js";import{u as N}from"./dynamic-table-3ORtHQM3.js";import{A as r}from"./index-BGRhdYbt.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-BEJgt-SP.js";import"./antdv-BbttoKUq.js";import"./index.vue_vue_type_style_index_0_lang-PCrZZ9h2.js";import{u as $}from"./useFormModal-Rxxc5YaB.js";import{u as g}from"./tabsView-UT0-65DI.js";import"./dateUtil-D7gJQxXe.js";import"./schema-form.vue_vue_type_script_setup_true_lang-ChTuMCM5.js";import"./is-DIFaXsjl.js";import"./index-5akZo7rI.js";import"./useModal-CiZQoqSP.js";const q=[{field:"typeId",component:"Select",label:"所属字典类型",rules:[{required:!0,type:"number"}]},{field:"label",component:"Input",label:"字典项名称",rules:[{required:!0,type:"string"}]},{field:"value",component:"Input",label:"字典项值",rules:[{required:!0,type:"string"}]},{field:"orderNo",component:"InputNumber",label:"排序",defaultValue:0,componentProps:{style:{width:"100%"}}},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},{field:"remark",component:"InputTextArea",label:"备注",colProps:{span:24}}],H=w({name:"SystemDictItem",__name:"index",setup(A){const f=g(),m=v(),i=C(Number(m.params.id));let l=[];const[b,a]=N({formProps:{schemas:k,initialValues:{typeId:i.value},onReset(e){Number.isInteger(e==null?void 0:e.typeId)&&(i.value=e.typeId)}}}),[y]=$();S(async()=>{var o,p;const e=await r.systemDictType.dictTypeGetAll();l=e.map(s=>({label:s.name,value:s.id,code:s.code}));const t=e.find(s=>s.id===i.value);f.updateTabTitle(`${m.meta.title}(${t==null?void 0:t.name})`),(p=(o=a==null?void 0:a.getSearchFormRef())==null?void 0:o.updateSchema)==null||p.call(o,[{field:"typeId",componentProps:{options:l,onChange(s){i.value=s}}}]),a==null||a.reload()});const d=async e=>{const[t]=await y({modalProps:{title:`${e.id?"编辑":"新增"}字典项`,width:"50%",onFinish:async o=>{e.id?await r.systemDictItem.dictItemUpdate({id:e.id},o):await r.systemDictItem.dictItemCreate(o),a==null||a.reload()}},formProps:{labelWidth:120,schemas:q}});t==null||t.updateSchema({field:"typeId",componentProps:{options:l,disabled:!0}}),t==null||t.setFieldsValue({typeId:i.value,...e})},h=async e=>{await r.systemDictItem.dictItemDelete({id:e.id}),a==null||a.reload()},I=[...x,{title:"操作",width:130,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"system:dict-item:update",effect:"disable"},onClick:()=>d(e)},{label:"删除",auth:"system:dict-item:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>h(e)}}]}];return(e,t)=>{const o=V("a-button");return _(),D("div",null,[n(c(b),{"row-key":"id","header-title":"字典项管理","data-request":c(r).systemDictItem.dictItemList,columns:I,bordered:"",immediate:!1,size:"small","search-params":{typeId:i.value}},{toolbar:u(()=>[n(o,{type:"primary",disabled:!e.$auth("system:dict-item:create"),onClick:t[0]||(t[0]=p=>d({}))},{default:u(()=>[P(" 新增 ")]),_:1},8,["disabled"])]),_:1},8,["data-request","search-params"])])}}});export{H as default};
