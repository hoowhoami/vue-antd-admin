import{r as R,a as m,w as _}from"./dynamic-table-3ORtHQM3.js";import{d as F}from"./dateUtil-D7gJQxXe.js";import{d as C,f as g,u as w,W as E,a5 as b,m as I,A as $,a6 as N,Z as j}from"./vue-nPfkdNmw.js";import{_ as U}from"./index-BGRhdYbt.js";import{w as A}from"./index-5akZo7rI.js";import"./index.vue_vue_type_style_index_0_lang-PCrZZ9h2.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-BEJgt-SP.js";import"./antdv-BbttoKUq.js";const B=C({name:"ImportExcel",props:{dateFormat:{type:String},timeZone:{type:Number,default:8}},emits:["success","error"],setup(r,{emit:o}){const s=g(null),u=g(!1);function d(e){if(!e||!e["!ref"])return[];const t=[],n=m.decode_range(e["!ref"]),h=n.s.r;for(let a=n.s.c;a<=n.e.c;++a){const i=e[m.encode_cell({c:a,r:h})];let p=`UNKNOWN ${a}`;i&&i.t&&(p=m.format_cell(i)),t.push(p)}return t}function c(e){const t=[],{dateFormat:n,timeZone:h}=r;for(const a of e.SheetNames){const i=e.Sheets[a],p=d(i);let k=m.sheet_to_json(i,{raw:!0,dateNF:n});k=k.map(f=>{for(const y in f)f[y]instanceof Date&&(h===8&&f[y].setSeconds(f[y].getSeconds()+43),n&&(f[y]=F(f[y]).format(n)));return f}),t.push({header:p,results:k,meta:{sheetName:a}})}return t}function l(e){u.value=!0;const{promise:t,resolve:n,reject:h}=Promise.withResolvers(),a=new FileReader;return a.onload=async i=>{try{const p=i.target&&i.target.result,k=R(p,{type:"array",cellDates:!0}),f=c(k);o("success",f),n("")}catch(p){h(p),o("error")}finally{u.value=!1}},a.readAsArrayBuffer(e),t}async function x(e){const t=w(s);t&&(t.value=""),await l(e)}function S(e){const t=e&&e.target.files,n=t&&t[0];n&&x(n)}function D(){const e=w(s);e&&e.click()}return{handleUpload:D,handleInputClick:S,inputRef:s}}});function T(r,o,s,u,d,c){return E(),b("div",null,[I(N("input",{ref:"inputRef",type:"file",accept:".xlsx, .xls",onChange:o[0]||(o[0]=(...l)=>r.handleInputClick&&r.handleInputClick(...l))},null,544),[[$,!1]]),N("div",{onClick:o[1]||(o[1]=(...l)=>r.handleUpload&&r.handleUpload(...l))},[j(r.$slots,"default")])])}const Z=U(B,[["render",T]]),v="excel-list.xlsx";function V({data:r,header:o,filename:s=v,json2sheetOpts:u={},write2excelOpts:d={bookType:"xlsx"}}){let c=[...r];if(o){c.unshift(o);const S=Object.keys(o);c=c.map(D=>S.reduce((e,t)=>(e[t]=D[t],e),{})),u.skipHeader=!0}const l=m.json_to_sheet(c,u),x={SheetNames:[s],Sheets:{[s]:l}};_(x,s,d)}function q({data:r,header:o,filename:s=v,write2excelOpts:u={bookType:"xlsx"}}){const d=[...r];o&&d.unshift(o);const c=m.aoa_to_sheet(d),l={SheetNames:[s],Sheets:{[s]:c}};_(l,s,u)}A(Z);export{q as a,V as j};
