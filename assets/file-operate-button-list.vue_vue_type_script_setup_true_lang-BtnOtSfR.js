import{_ as K}from"./file-upload-drawer.vue_vue_type_script_setup_true_lang-DF0Jymup.js";import{A as k}from"./index-BGRhdYbt.js";import"./index.vue_vue_type_style_index_0_lang-PCrZZ9h2.js";import{u as j}from"./useFormModal-Rxxc5YaB.js";import{aN as V,M as A,bg as E,e as C,bh as O,bi as R,y as W,x as m,bj as T,bk as U,bl as z,p as G,K as X,bm as Y,I as x,bn as H,bo as J,a0 as Q}from"./antdv-BbttoKUq.js";import{d as Z,f,c as v,w as D,W as w,a5 as ee,k as a,Y as t,X as ae,u as l,G as r,ad as te,ak as se,F as le,ac as ne}from"./vue-nPfkdNmw.js";const he=o=>[{field:"toName",component:"Input",label:`${o.type==="dir"?"文件夹":"文件"}名称`,defaultValue:o.name,rules:[{required:!0,type:"string",validator:(d,s)=>s&&s===o.name?Promise.reject("修改前后名称一致"):s&&!s.includes("/")?Promise.resolve():Promise.reject(`请输入合法${o.type==="dir"?"文件夹":"文件"}的名称`)}],componentProps:{placeholder:"输入重命名后的名称"}}],ie=[{field:"dirName",component:"Input",label:"文件夹名称",rules:[{required:!0,type:"string",validator:(o,d)=>d&&!d.includes("/")?Promise.resolve():Promise.reject("请输入合法的文件夹路径")}],componentProps:{placeholder:"请输入文件夹名称"}}],re=[{field:"key",component:"Input",label:"关键字",defaultValue:"",rules:[{required:!0,type:"string",validator:(o,d)=>d&&!d.includes("/")?Promise.resolve():Promise.reject("请输入合法的名称")}],componentProps:{placeholder:"请输入搜索关键字"}}],ye=Z({name:"FileOperateButtonList",__name:"file-operate-button-list",props:{selectedFileList:{type:Array,required:!0},parsePath:{type:Function,required:!0},searchKey:{type:String,required:!0},updateOperateStatus:{type:Function,required:!0}},emits:["changed","update:searchKey"],setup(o,{emit:d}){const s=o,c=d,[b]=j(),g=f(),n=f(!1),i=f(!1),h=f(""),y=f([]),F=v(()=>y.value.length>0?!1:s.selectedFileList.length<=0),S=v(()=>n.value&&h.value===s.parsePath()),P=v(()=>!V(s.searchKey));D(n,e=>{e&&(i.value&&(i.value=!1),M())}),D(i,e=>{e&&(n.value&&(n.value=!1),M())});const $=({key:e})=>{e==="copy"?i.value=!0:e==="cut"?n.value=!0:e==="delete"?A.confirm({title:"你确定要删除吗?",icon:a(E),onOk:N}):e==="cancel"&&(n.value=!1,i.value=!1,_())},M=()=>{y.value=O(s.selectedFileList),h.value=s.parsePath()},_=()=>{h.value="",y.value=[]},I=async()=>{try{s.updateOperateStatus(!0);const e={files:y.value,originPath:h.value,toPath:s.parsePath()};let u;if(n.value&&!i.value)await k.netDiskManage.netDiskManageCut(e),u="剪切",n.value=!1;else if(!n.value&&i.value)await k.netDiskManage.netDiskManageCopy(e),u="复制",i.value=!1;else throw new Error("unsupport operate");_(),C.success(`${u}成功`),c("changed")}finally{s.updateOperateStatus(!1)}},N=async()=>{const e=s.parsePath(),u=O(s.selectedFileList);await k.netDiskManage.netDiskManageDelete({path:e,files:u},{showSuccessMsg:!1}),C.success("已删除指定列表"),c("changed")},q=async()=>{if(P.value){c("update:searchKey","");return}await b({modalProps:{title:"全盘搜索",width:700,onFinish:async e=>{c("update:searchKey",e.key)}},formProps:{labelWidth:100,schemas:re}})},L=()=>{var e;(e=g.value)==null||e.open(s.parsePath())},B=async()=>{await b({modalProps:{title:"创建文件夹",width:700,onFinish:async e=>{await k.netDiskManage.netDiskManageMkdir({path:s.parsePath(),dirName:e.dirName}),c("changed")}},formProps:{labelWidth:100,schemas:ie}})};return(e,u)=>{const p=ne("a-button");return w(),ee(le,null,[a(l(Q),null,{default:t(()=>[i.value||n.value?(w(),ae(p,{key:0,disabled:S.value,onClick:I},{default:t(()=>[a(l(R)),r("粘贴 ")]),_:1},8,["disabled"])):te("",!0),a(l(W),{size:"small"},{overlay:t(()=>[a(l(m),{onClick:$},{default:t(()=>[a(l(m).Item,{key:"copy",disabled:!e.$auth("netdisk:manage:copy")},{default:t(()=>[a(l(T)),r(" 复制所选 ")]),_:1},8,["disabled"]),a(l(m).Item,{key:"cut",disabled:!e.$auth("netdisk:manage:cut")},{default:t(()=>[a(l(U),{rotate:-90}),r(" 剪切所选 ")]),_:1},8,["disabled"]),a(l(m).Item,{key:"delete",disabled:!e.$auth("netdisk:manage:delete")},{default:t(()=>[a(l(z)),r(" 删除所选 ")]),_:1},8,["disabled"]),a(l(m).Item,{key:"cancel",divider:"",disabled:!i.value&&!n.value},{default:t(()=>[a(l(G)),r(" 取消粘贴 ")]),_:1},8,["disabled"])]),_:1})]),default:t(()=>[a(l(X),{title:"注意：复制或剪切时会覆盖重名文件",placement:"top"},{default:t(()=>[a(p,{color:"#e6a23c",disabled:F.value},{icon:t(()=>[a(l(Y))]),default:t(()=>[r(" 批量操作 ")]),_:1},8,["disabled"])]),_:1})]),_:1}),a(p,{type:"success",disabled:!e.$auth("netdisk:manage:list"),onClick:q},{icon:t(()=>[a(l(x))]),default:t(()=>[r(" "+se(P.value?"取消搜索":"全盘搜索"),1)]),_:1},8,["disabled"]),a(p,{type:"primary",disabled:!e.$auth("netdisk:manage:token"),onClick:L},{icon:t(()=>[a(l(H))]),default:t(()=>[r(" 上传文件 ")]),_:1},8,["disabled"]),a(p,{onClick:B},{icon:t(()=>[a(l(J))]),default:t(()=>[r(" 创建文件夹 ")]),_:1})]),_:1}),a(K,{ref_key:"uploadDrawerRef",ref:g,onChanged:u[0]||(u[0]=oe=>e.$emit("changed"))},null,512)],64)}}});export{ye as _,he as g};
