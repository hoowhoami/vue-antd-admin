import{f as V}from"./index-5akZo7rI.js";import{A as _,I as $}from"./index-BGRhdYbt.js";import{f as B}from"./dateUtil-D7gJQxXe.js";import{d as S,W as o,a5 as I,f as l,c as F,X as f,Y as s,k as i,u as a,ae as L,F as N,G as x,y as P,ac as W,ak as E}from"./vue-nPfkdNmw.js";import{e as H,S as U,a0 as T,ar as j,Q as b,L as G,W as Q}from"./antdv-BbttoKUq.js";const X=["data","type"],Y=S({name:"preview-resource",__name:"index",props:{url:{type:String},type:{type:String}},setup(m){return(D,d)=>(o(),I("object",{key:m.url,data:m.url,type:m.type,width:"100%",height:"100%"},null,8,X))}}),Z=S({name:"FilePreviewDrawer",__name:"file-preview-drawer",setup(m,{expose:D}){const d=new Map([["name","文件名"],["mimeType","文件类型"],["hash","文件Hash"],["md5","文件MD5"],["fsize","文件大小"],["putTime","上传时间"],["uploader","上传人员"]]),w=l(!1),g=l(!1),h=l(""),k=l(""),t=l({}),u=l(""),c=l(""),y=l(!1),z=F(()=>`${u.value}?imageView2/2/w/500/h/210`),C=async(r,p)=>{g.value=!0,h.value=r,k.value=p,await P();try{w.value=!0;const v={name:r,path:p},n=await _.netDiskManage.netDiskManageInfo(v);if(c.value=n.mark,Array.from(d.keys()).forEach(e=>{e==="fsize"?t.value.fsize=V(n[e]):t.value[e]=n[e]}),t.value.putTime=B(n.putTime),t.value.name=r,$("netdisk:manage:download")){const e=await _.netDiskManage.netDiskManageDownload(v);u.value=e}}catch{M()}finally{w.value=!1}},A=async()=>{try{y.value=!0,await _.netDiskManage.netDiskManageMark({name:h.value,path:k.value,mark:c.value}),H.success("已更新文件备注")}finally{y.value=!1}},M=()=>{h.value="",k.value="",u.value="",c.value="",t.value={},g.value=!1};return D({open:C}),(r,p)=>{const v=W("a-button");return o(),f(a(Q),{title:"文件详情",width:500,visible:g.value,onClose:M},{default:s(()=>[i(a(U),{spinning:w.value,class:"preview-drawer-inner-box"},{default:s(()=>[i(a(T),{direction:"vertical"},{default:s(()=>{var n;return[(n=t.value.mimeType)!=null&&n.startsWith("image/")?(o(),f(a(j),{key:0,class:"w-full h-[210px]",src:z.value,preview:{src:u.value}},null,8,["src","preview"])):(o(),f(Y,{key:1,class:"w-full h-[210px]",url:u.value,type:t.value.mimeType},null,8,["url","type"])),i(a(b),{bordered:"",column:1,size:"small"},{default:s(()=>[(o(!0),I(N,null,L(a(d).keys(),e=>(o(),f(a(b).Item,{key:e,label:a(d).get(e),"label-style":{whiteSpace:"nowrap"}},{default:s(()=>[x(E(t.value[e]),1)]),_:2},1032,["label"]))),128)),i(a(b).Item,{label:"文件备注","label-style":{whiteSpace:"nowrap"}},{default:s(()=>[i(a(T),{direction:"vertical",align:"end"},{default:s(()=>[i(a(G).TextArea,{value:c.value,"onUpdate:value":p[0]||(p[0]=e=>c.value=e),disabled:!r.$auth("netdisk:manage:mark"),placeholder:"请输入文件备注",maxlength:100,rows:4,"show-count":""},null,8,["value","disabled"]),i(v,{loading:y.value,disabled:!r.$auth("netdisk:manage:mark"),type:"primary",size:"mini",onClick:A},{default:s(()=>[x("更新 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{Z as _};
