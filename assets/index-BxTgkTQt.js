import{f as g}from"./dateUtil-D7gJQxXe.js";import{U as v,X as w}from"./antdv-BbttoKUq.js";import{k as l,G as b,d as C,f as u,w as T,o as S,j as U,W as O,X as B,Y as N,u as R}from"./vue-nPfkdNmw.js";import{u as A}from"./dynamic-table-3ORtHQM3.js";import{U as j,A as f}from"./index-BGRhdYbt.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-BEJgt-SP.js";import"./schema-form.vue_vue_type_script_setup_true_lang-ChTuMCM5.js";import"./is-DIFaXsjl.js";import"./index-5akZo7rI.js";const D=[{title:"会话编号",dataIndex:"tokenId",ellipsis:!0,hideInSearch:!0},{title:"用户名",dataIndex:"username",customRender:({record:t})=>l("div",null,[l("span",{class:"pr-4px"},[t.username]),t.isCurrent&&l(v,{color:"processing"},{default:()=>[b("我")]})])},{title:"部门名称",dataIndex:"deptName"},{title:"登录IP",dataIndex:"ip",width:140},{title:"登录地点",dataIndex:"address"},{title:"浏览器",dataIndex:"browser"},{title:"操作系统",dataIndex:"os"},{title:"登录时间",dataIndex:"time",width:180,customRender:({record:t})=>g(t.time)}],W=C({name:"SystemMonitorOnline",__name:"index",setup(t){let d=[];const i=u(!0),r=u([]),c=u(!1),m=j(),[h,k]=A({size:"small"}),I=[...D,{title:"操作",width:80,dataIndex:"ACTION",actions:({record:e})=>[{label:"下线",auth:"system:online:kick",disabled:e.disable,popConfirm:{title:"确定下线该用户吗?",onConfirm:()=>x(e)}}]}],x=async e=>{await f.systemOnline.onlineKick({tokenId:e.tokenId}),k.reload()},_=(...e)=>{[...e]},y=e=>{const a=Object.keys(e);if(!a.some(o=>!!e[o])){n();return}r.value=d.filter(o=>a.every(s=>!e[s]||o[s].includes(e[s])))},n=async()=>{c.value=!0,d=await f.systemOnline.onlineList().finally(()=>c.value=!1),r.value=d},p=()=>{i.value&&n()};return T(i,e=>{e&&n()}),S(()=>{n(),m.emitter.on("onlineUser",p)}),U(()=>{m.emitter.off("onlineUser",p)}),(e,a)=>{const o=w;return O(),B(R(h),{"row-key":"tokenId","header-title":"在线用户","title-tooltip":"这是真实操作，请不要随意将其他用户踢下线。","data-source":r.value,columns:I,loading:c.value,onChange:_,onSearch:y,onReload:n},{toolbar:N(()=>[l(o,{checked:i.value,"onUpdate:checked":a[0]||(a[0]=s=>i.value=s),"checked-children":"开启实时更新","un-checked-children":"关闭实时更新"},null,8,["checked"])]),_:1},8,["data-source","loading"])}}});export{W as default};
